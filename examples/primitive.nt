#!/usr/bin/env ntalk
#
# Test primitive syntax with Nim code embedding
#

# Simple object with primitive method
TestObject := Object derive

TestObject at: 'add:and:" put: [
  <primitive>
  # Nim implementation of addition
  let a = args[0].intVal
  let b = args[1].intVal
  return NodeValue(kind: vkInt, intVal: a + b)
  </primitive>
  # Smalltalk fallback (should not be executed in Phase 2)
  ^ self error: 'Primitive failed'
].

# Create instance and test
test := TestObject derive
result := test add: 3 and: 4

# Return result
result