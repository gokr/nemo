#!/usr/bin/env ntalk
#
# stdlib_demo.nt - Demonstration of Nimtalk Standard Library
#

"========================================" println
"Nimtalk Standard Library Demo" println
"========================================" println
"" println

#====================================================================
# Numbers and Arithmetic
#====================================================================
"--- Numbers ---" println

x := 10
y := 3

("10 + 3 = " + (x + y) asString) println
("10 - 3 = " + (x - y) asString) println
("10 * 3 = " + (x * y) asString) println
("10 / 3 = " + (x / y) asString) println
("10 // 3 = " + (x // y) asString) println
("10 \\ 3 = " + (x \\ y) asString) println
("10 < 3 = " + (x < y) asString) println
("10 > 3 = " + (x > y) asString) println
("10 ~= 3 = " + (x ~= y) asString) println
("10 abs = " + (10 abs) asString) println
("-5 abs = " + (-5 abs) asString) println
("4 even = " + (4 even) asString) println
("5 odd = " + (5 odd) asString) println
"" println

#====================================================================
# Loops and Control Flow
#====================================================================
"--- Loops ---" println

"Counting to 5 with timesRepeat:" println
5 timesRepeat: [ "Hello!" println ]
"" println

"Counting with to:do:" println
1 to: 5 do: [ :i | ("Count: " + i asString) println ]
"" println

"While loop:" println
count := 0
[ count < 3 ] whileTrue: [
  ("While count: " + count asString) println
  count := count + 1
]
"" println

#====================================================================
# Arrays and Collections
#====================================================================
"--- Arrays ---" println

arr := Array new
arr add: 1
arr add: 2
arr add: 3
("Array size: " + arr size asString) println
("First element: " + arr first asString) println
("Last element: " + arr last asString) println
"" println

"Array iteration with do:" println
arr do: [ :each | ("Element: " + each asString) println ]
"" println

"Array new: 5 (sized array):" println
sized := Array new: 5
("Sized array size: " + sized size asString) println
"" println

"Creating array with collect:" println
squares := #(1 2 3 4 5) collect: [ :n | n * n ]
("Squares: " + squares asString) println
"" println

"Select (filter):" println
evens := #(1 2 3 4 5 6) select: [ :n | n even ]
("Evens: " + evens asString) println
"" println

"Reject (inverse filter):" println
odds := #(1 2 3 4 5 6) reject: [ :n | n even ]
("Odds: " + odds asString) println
"" println

"Inject:into: (reduce/fold):" println
sum := #(1 2 3 4 5) inject: 0 into: [ :acc :n | acc + n ]
("Sum 1..5: " + sum asString) println
"" println

"Detect (find first):" println
found := #(1 2 3 4 5) detect: [ :n | n > 3 ]
("First > 3: " + found asString) println
"" println

"anySatisfy:" println
hasEven := #(1 3 5 6 7) anySatisfy: [ :n | n even ]
("Has even: " + hasEven asString) println
"" println

"allSatisfy:" println
allPositive := #(1 2 3 4 5) allSatisfy: [ :n | n > 0 ]
("All positive: " + allPositive asString) println
"" println

#====================================================================
# Tables (Dictionaries)
#====================================================================
"--- Tables ---" println

table := Table new
table at: "name" put: "Alice"
table at: "age" put: 30
table at: "city" put: "Wonderland"

("Name: " + (table at: "name")) println
("Age: " + (table at: "age") asString) println
("Size: " + table size asString) println

"Table keys:" println
table keys do: [ :key | ("  Key: " + key) println ]
"" println

#====================================================================
# Strings
#====================================================================
"--- Strings ---" println

s := "Hello, World!"
("Original: " + s) println
("Size: " + s size asString) println
("Uppercase: " + s uppercase) println
("Lowercase: " + s lowercase) println
("Trim '  spaces  ': " + ("  spaces  " trim)) println
("Index of "World": " + (s indexOf: "World") asString) println
("Contains "Hello": " + (s includesSubString: "Hello") asString) println
("Replace: " + (s replace: "World" with: "Nimtalk")) println

"Split:" println
parts := "a,b,c,d" split: ','
parts do: [ :part | ("  Part: " + part) println ]
"" println

#====================================================================
# Blocks and Closures
#====================================================================
"--- Blocks ---" println

doubler := [ :n | n * 2 ]
("Double 5: " + (doubler value: 5) asString) println

summer := [ :a :b | a + b ]
("Sum 3+4: " + (summer value: 3 value: 4) asString) println
"" println

#====================================================================
# Object Utilities
#====================================================================
"--- Object Utilities ---" println

obj := Object derive
("Is nil: " + obj isNil asString) println
("Not nil: " + obj notNil asString) println
nil isNil println

#====================================================================
# Transcript
#====================================================================
"--- Transcript ---" println

Transcript show: 'Using Transcript: '
Transcript show: "Hello"
Transcript cr
"" println

#====================================================================
# Summary
#====================================================================
"========================================" println
"Demo complete!" println
"========================================" println
